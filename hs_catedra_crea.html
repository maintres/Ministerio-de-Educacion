<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Registro - MINISTERIO DE EDUCACIÓN SAN JUAN</title>
    <link rel="shortcut icon" href="img/LOGO.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #0f0f0f;
            font-family: 'Roboto', 'Segoe UI', sans-serif;
            color: #ffffff;
            min-height: 100vh;
        }
        
        .card {
            background-color: #212121;
            border: 1px solid #303030;
            border-radius: 12px;
            box-shadow: none;
        }
        
        .card-header {
            background-color: #212121;
            border-bottom: 1px solid #303030;
            border-radius: 12px 12px 0 0;
            padding: 20px 25px;
            color: #ffffff;
        }
        
        .card-header h4 {
            color: #ffffff;
            font-weight: 500;
            margin: 0;
            font-size: 1.5rem;
        }
        
        .card-body {
            padding: 30px;
            background-color: #212121;
            border-radius: 0 0 12px 12px;
        }
        
        .form-label {
            font-weight: 500;
            color: #ffffff;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .form-control {
            background-color: #303030;
            border: 1px solid #404040;
            color: #ffffff;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 0.95rem;
        }
        
        .form-control:focus {
            background-color: #303030;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);
            color: #ffffff;
        }
        
        .form-control::placeholder {
            color: #888888;
        }
        
        .btn-primary {
            background-color: #007bff;
            border: none;
            color: #ffffff;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
            color: #ffffff;
        }
        
        .btn-secondary {
            background-color: #303030;
            border: 1px solid #404040;
            color: #ffffff;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        
        .btn-secondary:hover {
            background-color: #404040;
            color: #ffffff;
        }
        
        h5 {
            color: #ffffff;
            font-weight: 500;
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #404040;
        }
        
        .row {
            margin-bottom: 20px;
        }
        
        .col-md-4, .col-md-6, .col-md-8 {
            margin-bottom: 15px;
        }
        
        .d-flex.gap-2 {
            margin-top: 25px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .card-body {
                padding: 20px;
            }
            
            .btn-primary, .btn-secondary {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            h5 {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">Crear Registro de Horas Cátedra</h4>
                    </div>
                    <div class="card-body">
                        <form id="formProfesor">
                            <!-- Profesor Information -->
                            <h5 class="mb-3">Información del Profesor</h5>
                            <div class="row mb-3">                                
                                <div class="col-md-4">
                                    <label class="form-label" for="dniInput">DNI</label>
                                    <input type="text" name="dni" class="form-control"
                                        id="dniInput"
                                        value=""
                                        pattern="[0-9]{8}" title="Ingresa exactamente 8 dígitos numéricos" required>                                
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label" for="apellidoInput">Apellido/s</label>
                                    <input type="text" name="apellido" class="form-control" id="apellidoInput" value="" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="nombreInput">Nombre/s</label>
                                    <input type="text" name="nombre" class="form-control" id="nombreInput" value="" required>
                                </div>                            
                            </div>                            
                            <!-- Cátedra Information -->
                            <h5 class="mb-3 mt-4">Información de la Cátedra</h5>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label" for="numExpInput">Número de Expediente</label>
                                    <input type="text" name="num_exp" class="form-control" id="numExpInput" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label" for="numDictamenInput">Número de Dictamen</label>
                                    <input type="text" name="num_dictamen" class="form-control" id="numDictamenInput" required>
                                </div>                                
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="form-label" for="fechaTomaInput">Fecha de toma de posesión</label>
                                    <input type="date" name="fecha_toma" class="form-control" id="fechaTomaInput" placeholder="DD/MM/YYYY" required>
                                </div>                               
                                <div class="col-md-8">
                                    <label class="form-label" for="escuelaInput">Escuela</label>
                                    <input type="text" name="escuela" class="form-control" id="escuelaInput" required>
                                </div>                                
                            </div>
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-primary" onclick="crearRegistro()">Crear</button>
                                <a class="btn btn-secondary" href="index.html">Cancelar</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Función para crear el registro
        function crearRegistro() {
            alert('Iniciando proceso...');
            
            // Obtener valores de los campos
            var dni = document.getElementById('dniInput').value;
            var apellido = document.getElementById('apellidoInput').value;
            var nombre = document.getElementById('nombreInput').value;
            var numExp = document.getElementById('numExpInput').value;
            var numDictamen = document.getElementById('numDictamenInput').value;
            var fechaToma = document.getElementById('fechaTomaInput').value;
            var escuela = document.getElementById('escuelaInput').value;
            
            // Verificar que todos los campos estén llenos
            if (!dni || !apellido || !nombre || !numExp || !numDictamen || !fechaToma || !escuela) {
                alert('Por favor, completa todos los campos requeridos');
                return;
            }
            
            // Crear objeto con los datos
            var datos = {
                dni: dni,
                apellido: apellido,
                nombre: nombre,
                num_exp: numExp,
                num_dictamen: numDictamen,
                fecha_toma: fechaToma,
                escuela: escuela
            };
            
            alert('Datos capturados: ' + JSON.stringify(datos));
            
            // Guardar en localStorage
            try {
                localStorage.setItem('datosProfesor', JSON.stringify(datos));
                alert('Datos guardados exitosamente. Redirigiendo...');
                
                // Redirigir a la página de lista
                window.location.href = 'hs_catedra_lista.html';
            } catch (error) {
                alert('Error al guardar los datos: ' + error.message);
            }
        }
        
        // Función para cargar datos existentes
        function cargarDatos() {
            try {
                // Intentar obtener datos de URL parameters
                var urlParams = new URLSearchParams(window.location.search);
                var dni = urlParams.get('dni');
                
                if (dni) {
                    // Cargar datos de la URL
                    document.getElementById('dniInput').value = dni;
                    document.getElementById('apellidoInput').value = urlParams.get('apellido') || '';
                    document.getElementById('nombreInput').value = urlParams.get('nombre') || '';
                    document.getElementById('numExpInput').value = urlParams.get('num_exp') || '';
                    document.getElementById('numDictamenInput').value = urlParams.get('num_dictamen') || '';
                    document.getElementById('fechaTomaInput').value = urlParams.get('fecha_toma') || '';
                    document.getElementById('escuelaInput').value = urlParams.get('escuela') || '';
                } else {
                    // Intentar cargar datos del localStorage
                    var datosGuardados = localStorage.getItem('datosProfesor');
                    if (datosGuardados) {
                        var datos = JSON.parse(datosGuardados);
                        document.getElementById('dniInput').value = datos.dni || '';
                        document.getElementById('apellidoInput').value = datos.apellido || '';
                        document.getElementById('nombreInput').value = datos.nombre || '';
                        document.getElementById('numExpInput').value = datos.num_exp || '';
                        document.getElementById('numDictamenInput').value = datos.num_dictamen || '';
                        document.getElementById('fechaTomaInput').value = datos.fecha_toma || '';
                        document.getElementById('escuelaInput').value = datos.escuela || '';
                    }
                }
            } catch (error) {
                console.error('Error al cargar datos:', error);
            }
        }
        
        // Función para validar DNI
        function validarDNI(input) {
            var dni = input.value.replace(/\D/g, '');
            if (dni.length > 8) {
                input.value = dni.substring(0, 8);
            }
        }
        
        // Inicializar cuando se carga la página
        function inicializarPagina() {
            alert('Página cargada correctamente');
            
            // Agregar evento para validar DNI
            var dniInput = document.getElementById('dniInput');
            if (dniInput) {
                dniInput.addEventListener('input', function() {
                    validarDNI(this);
                });
            }
            
            // Cargar datos existentes
            cargarDatos();
        }
        
        // Intentar inicializar de múltiples formas
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', inicializarPagina);
        } else {
            inicializarPagina();
        }
        
        // También intentar con window.onload
        window.addEventListener('load', inicializarPagina);
        
        // Para cuando se carga en modal
        setTimeout(inicializarPagina, 100);
    </script>
</body>
</html>